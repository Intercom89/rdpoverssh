# Приложение для работы с удаленным рабочим столом пк локальной сети через ssh.
( SSH + Kerio Control + RDP)

Используются библиотеки sshtunnel, PyQt5, threading и api Kerio Control скаченный с официального сайта.

Схема настройка серверной части:
Сервер SSH с белым IP, с ограниченным пользователем с параметром nologin, авторизацией по паролю или ключу. Kerio в качестве сервер шлюза с настройкой пользователей MS Active Directory и привязкой по MAC или IP для каждого пользователя.
В качестве логина выступает фамилия. Либо поле формы ввода фамилии можно изменить на Логин.
В качестве сервиса получения ip может выступать любая БД или сетевые сервисы. Если проект будет востребован функционал будет реализован. 

#### Принцип работы:

Приложение подключается по **ssh** к SSH серверу, который находится за файерволом с проброшенным заранее портом, либо включен SSH на самом файерволе, и пробрасывает порт 2222 на порт Kerio Contorol 4081. Подключается к api и делает запрос на поиск активного сетевого хоста по заданному имени. В качестве имени передается фамилия введенная в форме приложения. Далее ищется ip среди активных пк локальной сети. Далее приложение отключается от Kerio Control и закрывает SSH соединение.  Если ip не найден происходит выход. Если ip найден происходит повторное подключение к ssh серверу, но проброс порта происходит на найденный ip и порт RDP 3389.
Далее происходит внесение учетных данных в диспетчер учетных записей активного пользователя Windows с помощью вызова cmdkey.
Последним шагом инициируется новый процесс mstsc с передачей параметра адреса подключения localhost. Учетные данне для подключения при этом берутся из диспетчера учетных данных текущего пользователя Windows. Сразу после подключения инициируется запуск очистки учетных данных в диспетчере учетных данных windows от внесенных ранее туда учетных данных.

Настройка перед компиляцией в exe:
Основной файл запуска программы remotecli.py
Файл дизайна для python desing.py
Файл графических ресурсов res.py
Основной файл настройки подключения sshconnect.py
ВНИМАНИЕ!!!! в проекте выложен паблик и приват ключи SSH srv.key и srv.key.pub не используйте их!!! Сгенерируйте свои!!! Помните эти ключи выложены в ПАБЛИК, а значит они не безопасны!!!
```
publicipadress = ('REMOTE_PUBLIC_IP', 3232) # настройка ip адреса подключения к ssh серверу.
def sshtunconnect (address):
    ssh_username="LOGIN_SSH", # логин для подключения к ssh серверу 
    ssh_password="PASSWORD_SSH", # пароль для подключения к ssh серверу
    ssh_pkey="srv.key", # файл ключа для подключения к ssh серверу
    local_bind_address=('localhost', 2222) #  адрес и порт откуда происходит проброс

def sshtungetip():
    remote_bind_address=('IP_Kerio_FIREWALL', 4081), # ip адрес и порт kerio control
   
def rdpdataconnection():
    subprocess.call(f"cmdkey /add:localhost /user:DOMAINMAIN\{login} /pass:{password}") # Если пользователи не доменные DOMAIN\ убрать  
```
Файл kerio/kerio.py
```
username = "kerio_admin_read_access_login" логин от kerio control, достаточно ограниченной учетной записи с правами только для чтения
password = "kerio_admin_read_admin_pass"    пароль от kerio control
```
Планы:

:black_square_button: Делать или не делать вот в чем вопрос?
    
1. Реализация раздела настройки.
    
2. Реализация ручного указания ip на в настройках приложения.

3. Реализация получения ip из БД, с предварительно занесенных туда пользователей (клиент - серверная версия) через веб интерфейс.
    
....
